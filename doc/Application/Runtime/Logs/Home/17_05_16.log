[ 2017-05-16T14:06:17+08:00 ] ::1 /doc/
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.031002s ]
INFO: [ app_begin ] --END-- [ RunTime:0.032002s ]
SQL: SHOW COLUMNS FROM `user` [ RunTime:0.0790s ]
SQL: SELECT * FROM `user` WHERE ( cookie_token = '245d2c83356a5b37079f1b3756d7e8ed'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\2a94b8bda04ff446dcedd42276fc99ee.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.082004s ]
INFO: [ view_parse ] --END-- [ RunTime:0.082004s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T14:06:17+08:00 ] ::1 /doc/
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `user` [ RunTime:0.0040s ]
SQL: SELECT * FROM `user` WHERE ( cookie_token = '245d2c83356a5b37079f1b3756d7e8ed'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\2a94b8bda04ff446dcedd42276fc99ee.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.009000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.009000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T14:06:20+08:00 ] ::1 /doc/index.php/Home/Item/index
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.002000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0180s ]
SQL: SELECT * FROM `item` WHERE ( uid = '2' or item_id in ( select item_id from item_member where uid = '2' )  )  [ RunTime:0.0360s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\fbd4024b257c0eb32531d23fc561bc4e.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.011000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.012000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T14:06:22+08:00 ] ::1 /doc/index.php/Home/Item/Show?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0330s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0280s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0410s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0170s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.025001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.025001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001001s ]

[ 2017-05-16T14:06:26+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0060s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.014001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.014001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.002000s ]
INFO: [ app_end ] --END-- [ RunTime:0.002000s ]

[ 2017-05-16T16:29:04+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.001000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.008000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001001s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T16:29:06+08:00 ] ::1 /doc/index.php/Home/page/edit?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.002000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.002000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0050s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\647ced87fad8125be8d20ab06e614491.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.030002s ]
INFO: [ view_parse ] --END-- [ RunTime:0.030002s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T16:29:06+08:00 ] ::1 /doc/index.php/Home/catalog/catList?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0030s ]
SQL: SELECT * FROM `catalog` WHERE (  item_id = '24'  ) ORDER BY  'order', addtime asc    [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T16:31:41+08:00 ] ::1 /doc/index.php/Home/page/save
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page_history` [ RunTime:0.0270s ]
SQL: INSERT INTO `page_history` (`page_id`,`item_id`,`cat_id`,`page_title`,`page_content`,`order`,`addtime`,`author_uid`,`author_username`) VALUES ('202','24','52','网站访问分析','
------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl

查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID','99','1493370590','2','admin') [ RunTime:0.0210s ]
SQL: UPDATE `page` SET `page_title`='网站访问分析',`page_content`='------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl

查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### ',`order`='99',`item_id`='24',`cat_id`='52',`addtime`='1494923501',`author_uid`='2',`author_username`='admin' WHERE (  page_id = '202'  ) [ RunTime:0.0020s ]
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0050s ]
SQL: UPDATE `item` SET `last_update_time`='1494923501' WHERE (  item_id = '24'  ) [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T16:31:41+08:00 ] ::1 /doc/index.php/Home/item/show?page_id=202&item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0040s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.019001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.019001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001001s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T16:31:41+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0050s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.006000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.006000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:12:59+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001001s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.001000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.007000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.007000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:13:01+08:00 ] ::1 /doc/index.php/Home/page/edit?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0020s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\647ced87fad8125be8d20ab06e614491.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.008001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.009001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:13:01+08:00 ] ::1 /doc/index.php/Home/catalog/catList?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.002000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.002000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0020s ]
SQL: SELECT * FROM `catalog` WHERE (  item_id = '24'  ) ORDER BY  'order', addtime asc    [ RunTime:0.0000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:13:28+08:00 ] ::1 /doc/index.php/Home/page/save
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001001s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page_history` [ RunTime:0.0030s ]
SQL: INSERT INTO `page_history` (`page_id`,`item_id`,`cat_id`,`page_title`,`page_content`,`order`,`addtime`,`author_uid`,`author_username`) VALUES ('202','24','52','网站访问分析','------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl

查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### ','99','1494923501','2','admin') [ RunTime:0.0010s ]
SQL: UPDATE `page` SET `page_title`='网站访问分析',`page_content`='------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl

查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME',`order`='99',`item_id`='24',`cat_id`='52',`addtime`='1494926008',`author_uid`='2',`author_username`='admin' WHERE (  page_id = '202'  ) [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: UPDATE `item` SET `last_update_time`='1494926008' WHERE (  item_id = '24'  ) [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:13:28+08:00 ] ::1 /doc/index.php/Home/item/show?page_id=202&item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0050s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.019002s ]
INFO: [ view_parse ] --END-- [ RunTime:0.019002s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:13:28+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.006000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.007000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:28:29+08:00 ] ::1 /doc/index.php/Home/page/edit?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.002000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\647ced87fad8125be8d20ab06e614491.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.009001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.010001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:28:29+08:00 ] ::1 /doc/index.php/Home/catalog/catList?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0050s ]
SQL: SELECT * FROM `catalog` WHERE (  item_id = '24'  ) ORDER BY  'order', addtime asc    [ RunTime:0.0000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:30:45+08:00 ] ::1 /doc/index.php/Home/page/save
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `page_history` [ RunTime:0.0030s ]
SQL: INSERT INTO `page_history` (`page_id`,`item_id`,`cat_id`,`page_title`,`page_content`,`order`,`addtime`,`author_uid`,`author_username`) VALUES ('202','24','52','网站访问分析','------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl

查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME','99','1494926008','2','admin') [ RunTime:0.0000s ]
SQL: UPDATE `page` SET `page_title`='网站访问分析',`page_content`='------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl
###### 查询（table、bar和pie） dao中查询大类的方法 getDomainTrafficPercent
###### 查询（table、bar和pie） dao中查询小类的方法 getDomainSmallTrafficPercent
###### 查询（area） dao中查询大类的方法 getDomainTrafficTrend
###### 查询（area） dao中查询小类的方法 getDomainSmallTrafficTrend



查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME',`order`='99',`item_id`='24',`cat_id`='52',`addtime`='1494927045',`author_uid`='2',`author_username`='admin' WHERE (  page_id = '202'  ) [ RunTime:0.0020s ]
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: UPDATE `item` SET `last_update_time`='1494927045' WHERE (  item_id = '24'  ) [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:30:45+08:00 ] ::1 /doc/index.php/Home/item/show?page_id=202&item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0040s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.019001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.019001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001001s ]
INFO: [ app_end ] --END-- [ RunTime:0.001001s ]

[ 2017-05-16T17:30:46+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.007001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.007001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:30:51+08:00 ] ::1 /doc/index.php/Home/page/edit?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\647ced87fad8125be8d20ab06e614491.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.010000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.010000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:30:51+08:00 ] ::1 /doc/index.php/Home/catalog/catList?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001001s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0040s ]
SQL: SELECT * FROM `catalog` WHERE (  item_id = '24'  ) ORDER BY  'order', addtime asc    [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:31:18+08:00 ] ::1 /doc/index.php/Home/page/save
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0020s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page_history` [ RunTime:0.0030s ]
SQL: INSERT INTO `page_history` (`page_id`,`item_id`,`cat_id`,`page_title`,`page_content`,`order`,`addtime`,`author_uid`,`author_username`) VALUES ('202','24','52','网站访问分析','------------
网站访问分析
webTrafficQuery.jsp
webTraffic.jsp

WebBehaviorController
WebBehaviorServiceImpl
WebBehaviorDaoImpl
###### 查询（table、bar和pie） dao中查询大类的方法 getDomainTrafficPercent
###### 查询（table、bar和pie） dao中查询小类的方法 getDomainSmallTrafficPercent
###### 查询（area） dao中查询大类的方法 getDomainTrafficTrend
###### 查询（area） dao中查询小类的方法 getDomainSmallTrafficTrend



查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME','99','1494927045','2','admin') [ RunTime:0.0010s ]
SQL: UPDATE `page` SET `page_title`='网站访问分析',`page_content`='------------
## 网站访问分析
###### webTrafficQuery.jsp
###### webTraffic.jsp

###### WebBehaviorController
###### WebBehaviorServiceImpl
###### WebBehaviorDaoImpl
###### 查询（table、bar和pie） dao中查询大类的方法 getDomainTrafficPercent
###### 查询（table、bar和pie） dao中查询小类的方法 getDomainSmallTrafficPercent
###### 查询（area） dao中查询大类的方法 getDomainTrafficTrend
###### 查询（area） dao中查询小类的方法 getDomainSmallTrafficTrend



查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME',`order`='99',`item_id`='24',`cat_id`='52',`addtime`='1494927078',`author_uid`='2',`author_username`='admin' WHERE (  page_id = '202'  ) [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: UPDATE `item` SET `last_update_time`='1494927078' WHERE (  item_id = '24'  ) [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:31:18+08:00 ] ::1 /doc/index.php/Home/item/show?page_id=202&item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0030s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.019001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.019001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:31:18+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.001000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.011000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.011000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:31:29+08:00 ] ::1 /doc/index.php/Home/page/edit?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.000000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\647ced87fad8125be8d20ab06e614491.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.009001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.009001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.007000s ]
INFO: [ app_end ] --END-- [ RunTime:0.007000s ]

[ 2017-05-16T17:31:29+08:00 ] ::1 /doc/index.php/Home/catalog/catList?item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0030s ]
SQL: SELECT * FROM `catalog` WHERE (  item_id = '24'  ) ORDER BY  'order', addtime asc    [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T17:32:17+08:00 ] ::1 /doc/index.php/Home/page/save
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page_history` [ RunTime:0.0020s ]
SQL: INSERT INTO `page_history` (`page_id`,`item_id`,`cat_id`,`page_title`,`page_content`,`order`,`addtime`,`author_uid`,`author_username`) VALUES ('202','24','52','网站访问分析','------------
## 网站访问分析
###### webTrafficQuery.jsp
###### webTraffic.jsp

###### WebBehaviorController
###### WebBehaviorServiceImpl
###### WebBehaviorDaoImpl
###### 查询（table、bar和pie） dao中查询大类的方法 getDomainTrafficPercent
###### 查询（table、bar和pie） dao中查询小类的方法 getDomainSmallTrafficPercent
###### 查询（area） dao中查询大类的方法 getDomainTrafficTrend
###### 查询（area） dao中查询小类的方法 getDomainSmallTrafficTrend



查询sql之一
SELECT
	T . ID,
	T . NAME,
	T .pid,
	traff.apptraffic_total,
	to_char(
		traff.starttime,
		\'yyyy-mm-dd hh24\'
	) starttime
FROM
	(
		SELECT
			tmp.pid,
			round(
				SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
				2
			) AS apptraffic_total,
			st.starttime
		FROM
			(
				SELECT
					A . ID ID,
					A .pid AS pid,
					A .nid AS nid,
					A . NAME,
					b. NAME AS p_name,
					A .url
				FROM
					t_url_group A
				LEFT JOIN t_url_group b ON A .pid = b. ID
				WHERE
					A . TYPE = 2
				ORDER BY
					A . ID
			) tmp,
			st_traff_domain_hour st
		WHERE
			tmp.url = st. HOST
		AND st.starttime &gt;= \'2017-04-28 00:15\'
		AND st.starttime &lt;= \'2017-04-28 23:15\'
		GROUP BY
			tmp.pid,
			st.starttime
		ORDER BY
			st.starttime ASC
	) traff,
	t_url_group T
WHERE
	traff.pid = T . ID
	
	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME','99','1494927078','2','admin') [ RunTime:0.0000s ]
SQL: UPDATE `page` SET `page_title`='网站访问分析',`page_content`='------------
## 网站访问分析
###### webTrafficQuery.jsp
###### webTraffic.jsp

###### WebBehaviorController
###### WebBehaviorServiceImpl
###### WebBehaviorDaoImpl
###### 查询（table、bar和pie） dao中查询大类的方法 getDomainTrafficPercent
###### 查询（table、bar和pie） dao中查询小类的方法 getDomainSmallTrafficPercent
###### 查询（area） dao中查询大类的方法 getDomainTrafficTrend
###### 查询（area） dao中查询小类的方法 getDomainSmallTrafficTrend


###### 原先查询的sql，现在已改为后面两种
	查询sql之一
	SELECT
		T . ID,
		T . NAME,
		T .pid,
		traff.apptraffic_total,
		to_char(
			traff.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		(
			SELECT
				tmp.pid,
				round(
					SUM (st.apptraffic_total) * 8.0 / (1024 * 1024) / 3600,
					2
				) AS apptraffic_total,
				st.starttime
			FROM
				(
					SELECT
						A . ID ID,
						A .pid AS pid,
						A .nid AS nid,
						A . NAME,
						b. NAME AS p_name,
						A .url
					FROM
						t_url_group A
					LEFT JOIN t_url_group b ON A .pid = b. ID
					WHERE
						A . TYPE = 2
					ORDER BY
						A . ID
				) tmp,
				st_traff_domain_hour st
			WHERE
				tmp.url = st. HOST
			AND st.starttime &gt;= \'2017-04-28 00:15\'
			AND st.starttime &lt;= \'2017-04-28 23:15\'
			GROUP BY
				tmp.pid,
				st.starttime
			ORDER BY
				st.starttime ASC
		) traff,
		t_url_group T
	WHERE
		traff.pid = T . ID

	
###### 网站访问分析获取表格和bar、pie数据sql
###### 有用户时查询st_traff_user_url_hour表否则查询st_traff_url_hour表
	SELECT
		stu.url_pid AS nid,
		tug.name AS NAME,
		SUM (stu.apptraffic_total) apptraffic_total,
		SUM (apptraffic_up) apptraffic_up,
		SUM (stu.apptraffic_dn) apptraffic_dn,
		SUM (hitnum) hitnum,
		round(
			MAX (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS maxspeed,
		round(
			MIN (stu.apptraffic_total) * 8.0 / 3600,
			2
		) AS minspeed,
		round(
			SUM (stu.apptraffic_total) * 8.0 / 82800,
			2
		) AS avgspeed
	FROM
		st_traff_user_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:57\'
	AND stu.starttime &lt;= \'2017-05-16 23:57\'
	AND stu.userid IN (53, 54)
	GROUP BY
		stu.url_pid,
		tug. NAME
	ORDER BY
		apptraffic_total DESC OFFSET 0
	LIMIT 10
	
###### 获取堆积图area
	SELECT
		stu.url_pid AS pid,
		tug. NAME AS NAME,
		SUM (apptraffic_total) AS apptraffic_total,
		to_char(
			stu.starttime,
			\'yyyy-mm-dd hh24\'
		) starttime
	FROM
		st_traff_url_hour stu
	LEFT JOIN t_url_group tug ON stu.url_pid = tug. ID
	WHERE
		stu.starttime &gt;= \'2017-05-16 00:28\'
	AND stu.starttime &lt;= \'2017-05-16 23:28\'
	AND stu.url_pid IN (
		SELECT
			T .url_pid
		FROM
			(
				SELECT
					url_pid,
					SUM (apptraffic_total) AS apptraffic_total
				FROM
					st_traff_url_hour
				GROUP BY
					url_pid
				ORDER BY
					apptraffic_total DESC OFFSET 0
				LIMIT 10
			) T
	)
	GROUP BY
		stu.url_pid,
		starttime,
		tug. NAME',`order`='99',`item_id`='24',`cat_id`='52',`addtime`='1494927137',`author_uid`='2',`author_username`='admin' WHERE (  page_id = '202'  ) [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0030s ]
SQL: UPDATE `item` SET `last_update_time`='1494927137' WHERE (  item_id = '24'  ) [ RunTime:0.0000s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:32:17+08:00 ] ::1 /doc/index.php/Home/item/show?page_id=202&item_id=24
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0040s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0030s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0040s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.019001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.020001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

[ 2017-05-16T17:32:17+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.000000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0040s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0000s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.008000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.003001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.003001s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T18:18:20+08:00 ] ::1 /doc/index.php/24?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.001001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001001s ]
NOTIC: [2048] Declaration of Home\Controller\ItemController::show() should be compatible with Think\Controller::show($content, $charset = '', $contentType = '', $prefix = '') D:\wamp\www\doc\Application\Home\Controller\ItemController.class.php 第 4 行.
SQL: SHOW COLUMNS FROM `item` [ RunTime:0.0050s ]
SQL: SELECT * FROM `item` WHERE ( item_id = '24'  ) LIMIT 1   [ RunTime:0.0040s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0110s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '0' and item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0000s ]
SQL: SHOW COLUMNS FROM `catalog` [ RunTime:0.0030s ]
SQL: SELECT * FROM `catalog` WHERE ( item_id = '24'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '52'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
SQL: SELECT * FROM `page` WHERE ( cat_id = '53'  ) ORDER BY  `order` asc    [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.000000s ]
NOTIC: [8] Undefined variable: page_id D:\wamp\www\doc\Application\Runtime\Cache\Home\a45e27ab7210323bbf6beb0424918ca7.php 第 99 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.023001s ]
INFO: [ view_parse ] --END-- [ RunTime:0.024001s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.001000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.001000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.001000s ]
INFO: [ app_end ] --END-- [ RunTime:0.001000s ]

[ 2017-05-16T18:18:21+08:00 ] ::1 /doc/index.php/Home/page/index?page_id=202
INFO: [ app_init ] --START--
INFO: Run Behavior\BuildLiteBehavior [ RunTime:0.000000s ]
INFO: [ app_init ] --END-- [ RunTime:0.001000s ]
INFO: [ app_begin ] --START--
INFO: Run Behavior\ReadHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.001000s ]
SQL: SHOW COLUMNS FROM `page` [ RunTime:0.0070s ]
SQL: SELECT * FROM `page` WHERE (  page_id = '202'  ) LIMIT 1   [ RunTime:0.0010s ]
INFO: [ view_parse ] --START--
INFO: [ template_filter ] --START--
INFO: Run Behavior\ContentReplaceBehavior [ RunTime:0.000000s ]
INFO: [ template_filter ] --END-- [ RunTime:0.001000s ]
NOTIC: [8] Undefined variable: item D:\wamp\www\doc\Application\Runtime\Cache\Home\68bce0ec7afdf8798ef65138f610dc8c.php 第 5 行.
INFO: Run Behavior\ParseTemplateBehavior [ RunTime:0.007000s ]
INFO: [ view_parse ] --END-- [ RunTime:0.008000s ]
INFO: [ view_filter ] --START--
INFO: Run Behavior\WriteHtmlCacheBehavior [ RunTime:0.000000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.000000s ]
INFO: [ app_end ] --START--
INFO: Run Behavior\ShowPageTraceBehavior [ RunTime:0.000000s ]
INFO: [ app_end ] --END-- [ RunTime:0.000000s ]

